{
  "reports": [
    {
      "id": "expiring-items_1.0",
      "name": "Expiring Items",
      "type": "OmSupply",
      "template": {
        "index": {
          "template": "template.html",
          "header": null,
          "footer": null,
          "query": [
            "query.graphql"
          ]
        },
        "entries": {
          "template.html": {
            "type": "TeraTemplate",
            "data": {
              "output": "Html",
              "template": "<style>{% include \"style.css\" %}</style>\n\n<div class=\"container\">\n  <table>\n    <thead>\n      <tr class=\"heading\">\n        <td>Code</td>\n        <td>Name</td>\n        <td>Expiring in (days)</td>\n        <td>Batch</td>\n        <td>Expiry date</td>\n        <td>Stock on hand</td>\n        <td>Expected usage</td>\n        <td>Stock at risk</td>\n      </tr>\n    </thead>\n    <tbody>\n      {% for stockLine in data.stockLines.nodes %}\n      {% set now = now() | date(format=\"%s\") | int %}\n\n      <tr>\n        <td>{{stockLine.item.code}}</td>\n        <td>{{stockLine.item.name}}</td>\n        <td class=\"expiry-date\">\n          {% if stockLine.expiryDate %}\n            {% set expiryDate = stockLine.expiryDate | date(format=\"%s\") | int %}\n              {% if expiryDate > now %}\n                {% set diff = (expiryDate - now) / 60 / 60 / 24 | int %}\n                {% if diff <= arguments.monthsItemsExpire * 30 %}\n                  <span class=\"soon\">{{ diff }}</span>\n                {% else %}\n                  <span class=\"all-good\">{{ diff }}</span>\n                {% endif %}\n              {% else %}\n               <span class=\"expired\">Expired</span>\n              {% endif %}\n          {% else %}\n            <span class=\"na\">N/A</span>\n          {% endif %}\n        </td>\n        <td>{{stockLine.batch}}</td>\n        <td>\n          {% if stockLine.expiryDate %}\n            {{ stockLine.expiryDate | date(format=\"%d/%m/%Y\") }}\n          {% else %}\n            \n          {% endif %}\n        </td>\n        <td>{{stockLine.totalNumberOfPacks * stockLine.packSize | round( precision=1)\n          }}</td>\n        <td>\n          {% if stockLine.item.stats.averageMonthlyConsumption %}\n            {% if stockLine.expiryDate %}\n              {% set expiryDate = stockLine.expiryDate | date(format=\"%s\") | int %}\n              {% if expiryDate > now %}\n                {% set diffMonths = (expiryDate - now) / 60 / 60 / 24 / 30 | int | abs %}\n                {% set expectedUsage = stockLine.item.stats.averageMonthlyConsumption\n                  * diffMonths %}\n                {{ expectedUsage | round( precision=1) }}\n              {% else %}\n                N/A\n              {% endif %}\n            {% else %}\n              N/A\n            {% endif %}\n          {% else %}\n            N/A\n          {% endif %}\n        </td>\n        <td>\n          {% if stockLine.item.stats.averageMonthlyConsumption %}\n            {% if stockLine.expiryDate %}\n              {% set expiryDate = stockLine.expiryDate | date(format=\"%s\") | int %}\n              {% if expiryDate > now %}\n                {% set diffMonths = (expiryDate - now) / 60 / 60 / 24 / 30 | int | abs %}\n                {% set expectedUsage = stockLine.item.stats.averageMonthlyConsumption\n                  * diffMonths %}\n                {{ stockLine.totalNumberOfPacks * stockLine.packSize - expectedUsage | round( precision=1) }}\n              {% else %}\n                {{ stockLine.totalNumberOfPacks * stockLine.packSize | round( precision=1) }}\n              {% endif %}\n            {% else %}\n              N/A\n            {% endif %}\n          {% else %}\n            {% if stockLine.expiryDate %}\n              {% set expiryDate = stockLine.expiryDate | date(format=\"%s\") | int %}\n              {% if expiryDate < now %} \n                {{ stockLine.totalNumberOfPacks * stockLine.packSize | round( precision=1) }}\n              {% else %}\n                N/A\n              {% endif %}\n            {% else %}\n              N/A\n            {% endif %}\n          {% endif %}\n        </td>\n      </tr>\n      {% endfor %}\n    </tbody>\n  </table>\n</div>"
            }
          },
          "style.css": {
            "type": "Resource",
            "data": "@page {\n  margin: 0;\n  size: A4 landscape;\n}\n\n.paging {\n  width: 100%;\n}\n\n.container {\n  margin: auto;\n  padding: 10px;\n  font-size: 14px;\n  font-family: \"Helvetica Neue\", \"Helvetica\", Helvetica, Arial, sans-serif;\n  color: #555;\n}\n\n.container table {\n  width: 100%;\n  font-size: inherit;\n  font-family: inherit;\n  text-align: left;\n  margin-top: 10;\n  margin-bottom: 15;\n}\n\n.container table td {\n  padding: 5px;\n  vertical-align: top;\n}\n\n.container table tr.heading td {\n  font-weight: bold;\n  margin-bottom: 15px;\n}\n\n.container table td.expiry-date span {\n  padding: 2px;\n  border-radius: 10px;\n}\n\n.container table td.expiry-date span.expired::before {\n  content: \"\";\n  display: inline-block;\n  width: 10px;\n  height: 10px;\n  border-radius: 50%;\n  background-color: rgba(245, 5, 1, 0.6);\n  margin-right: 5px;\n}\n\n.container table td.expiry-date span.expired {\n  background-color: rgba(245, 5, 1, 0.3);\n  padding: 3px 10px;\n}\n\n.container table td.expiry-date span.soon::before {\n  content: \"\";\n  display: inline-block;\n  width: 10px;\n  height: 10px;\n  border-radius: 50%;\n  background-color: rgba(248, 154, 1, 0.6);\n  margin-right: 5px;\n}\n\n.container table td.expiry-date span.soon {\n  background-color: rgba(248, 154, 1, 0.3);\n  padding: 3px 10px;\n}\n\n.container table td.expiry-date span.all-good::before {\n  content: \"\";\n  display: inline-block;\n  width: 10px;\n  height: 10px;\n  border-radius: 50%;\n  background-color: rgba(51, 169, 1, 0.6);\n  margin-right: 5px;\n}\n\n.container table td.expiry-date span.all-good {\n  background-color: rgba(51, 169, 1, 0.3);\n  padding: 3px 10px;\n}\n\n.container table span.na::before {\n  content: \"\";\n  display: inline-block;\n  width: 10px;\n  height: 10px;\n  border-radius: 50%;\n  background-color: rgba(143, 144, 166, 0.6);\n  margin-right: 5px;\n}\n\n.container table td.expiry-date span.na {\n  background-color: rgba(143, 144, 166, 0.3);\n  padding: 3px 10px;\n}"
          },
          "query.graphql": {
            "type": "GraphGLQuery",
            "data": {
              "query": "query ExpiringItems(\n  $storeId: String\n  $itemCodeOrName: String\n  $expiryDate: String\n) {\n  stockLines(\n    storeId: $storeId\n    filter: {\n      itemCodeOrName: { like: $itemCodeOrName }\n      expiryDate: { beforeOrEqualTo: $expiryDate }\n      hasPacksInStore: true\n    }\n    sort: { key: itemName, desc: false }\n    page: { first: 5000 }\n  ) {\n    ... on StockLineConnector {\n      nodes {\n        batch\n        expiryDate\n        id\n        packSize\n        storeId\n        totalNumberOfPacks\n        supplierName\n        location {\n          code\n        }\n        item {\n          code\n          name\n          unitName\n          stats(storeId: $storeId) {\n            averageMonthlyConsumption\n          }\n        }\n      }\n    }\n  }\n}\n",
              "variables": null
            }
          }
        }
      },
      "context": "REPORT",
      "sub_context": "Expiring",
      "argument_schema_id": "for_report_expiring-items_1.0",
      "comment": null,
      "is_custom": false,
      "version": "1.0",
      "code": "expiring-items",
      "form_schema": {
        "id": "for_report_expiring-items_1.0",
        "type": "reportArgument",
        "json_schema": {
          "$schema": "http://json-schema.org/draft-07/schema#",
          "allOf": [
            {
              "$ref": "#/definitions/StockFilters"
            }
          ],
          "definitions": {
            "StockFilters": {
              "properties": {
                "expiryDate": {
                  "description": "Expiry Date",
                  "format": "date",
                  "type": "string"
                },
                "itemCodeOrName": {
                  "description": "Item Code or Name",
                  "type": "string"
                },
                "monthlyConsumptionLookBackPeriod": {
                  "description": "Average Monthly Consumption Look Back Period",
                  "readOnly": true,
                  "type": "number"
                },
                "monthsItemsExpire": {
                  "description": "Expiring item period",
                  "readOnly": true,
                  "type": "number"
                },
                "monthsOverstock": {
                  "description": "Months Overstock",
                  "readOnly": true,
                  "type": "number"
                },
                "monthsUnderstock": {
                  "description": "Months Understock",
                  "readOnly": true,
                  "type": "number"
                }
              }
            }
          },
          "type": "object"
        },
        "ui_schema": {
          "elements": [
            {
              "label": "Expiry Date",
              "options": {
                "dateOnly": true
              },
              "scope": "#/properties/expiryDate",
              "type": "Control"
            },
            {
              "label": "Item Code or Name",
              "options": {
                "flexBasis": "90%",
                "useDebounce": false
              },
              "scope": "#/properties/itemCodeOrName",
              "type": "Control"
            },
            {
              "label": "AMC Lookback Period",
              "options": {
                "inputAlignment": "end",
                "paddingRight": 25
              },
              "scope": "#/properties/monthlyConsumptionLookBackPeriod",
              "type": "Control"
            },
            {
              "label": "Target MOS",
              "options": {
                "inputAlignment": "end",
                "paddingRight": 25
              },
              "scope": "#/properties/monthsOverstock",
              "type": "Control"
            },
            {
              "label": "Reorder threshold MOS",
              "options": {
                "inputAlignment": "end",
                "paddingRight": 25
              },
              "scope": "#/properties/monthsUnderstock",
              "type": "Control"
            },
            {
              "label": "Expiring item period",
              "options": {
                "inputAlignment": "end",
                "paddingRight": 25
              },
              "scope": "#/properties/monthsItemsExpire",
              "type": "Control"
            }
          ],
          "type": "VerticalLayout"
        }
      }
    },
    {
      "id": "expiring-items_2.3.0",
      "name": "Expiring Items",
      "type": "OmSupply",
      "template": {
        "index": {
          "template": "template.html",
          "header": null,
          "footer": null,
          "query": [
            "query.graphql"
          ]
        },
        "entries": {
          "style.css": {
            "type": "Resource",
            "data": "@page {\n  margin: 0;\n  size: A4 landscape;\n}\n\n.paging {\n  width: 100%;\n}\n\n.container {\n  margin: auto;\n  padding: 10px;\n  font-size: 14px;\n  font-family: \"Helvetica Neue\", \"Helvetica\", Helvetica, Arial, sans-serif;\n  color: #555;\n}\n\n.container table {\n  width: 100%;\n  font-size: inherit;\n  font-family: inherit;\n  text-align: left;\n  margin-top: 10;\n  margin-bottom: 15;\n}\n\n.container table td {\n  padding: 5px;\n  vertical-align: top;\n}\n\n.container table tr.heading td {\n  font-weight: bold;\n  margin-bottom: 15px;\n}\n\n.container table td.expiry-date span {\n  padding: 2px;\n  border-radius: 10px;\n}\n\n.container table td.expiry-date span.expired::before {\n  content: \"\";\n  display: inline-block;\n  width: 10px;\n  height: 10px;\n  border-radius: 50%;\n  background-color: rgba(245, 5, 1, 0.6);\n  margin-right: 5px;\n}\n\n.container table td.expiry-date span.expired {\n  background-color: rgba(245, 5, 1, 0.3);\n  padding: 3px 10px;\n}\n\n.container table td.expiry-date span.soon::before {\n  content: \"\";\n  display: inline-block;\n  width: 10px;\n  height: 10px;\n  border-radius: 50%;\n  background-color: rgba(248, 154, 1, 0.6);\n  margin-right: 5px;\n}\n\n.container table td.expiry-date span.soon {\n  background-color: rgba(248, 154, 1, 0.3);\n  padding: 3px 10px;\n}\n\n.container table td.expiry-date span.all-good::before {\n  content: \"\";\n  display: inline-block;\n  width: 10px;\n  height: 10px;\n  border-radius: 50%;\n  background-color: rgba(51, 169, 1, 0.6);\n  margin-right: 5px;\n}\n\n.container table td.expiry-date span.all-good {\n  background-color: rgba(51, 169, 1, 0.3);\n  padding: 3px 10px;\n}\n\n.container table span.na::before {\n  content: \"\";\n  display: inline-block;\n  width: 10px;\n  height: 10px;\n  border-radius: 50%;\n  background-color: rgba(143, 144, 166, 0.6);\n  margin-right: 5px;\n}\n\n.container table td.expiry-date span.na {\n  background-color: rgba(143, 144, 166, 0.3);\n  padding: 3px 10px;\n}"
          },
          "query.graphql": {
            "type": "GraphGLQuery",
            "data": {
              "query": "query ExpiringItems(\n  $storeId: String\n  $itemCodeOrName: String\n  $expiryDate: String\n) {\n  stockLines(\n    storeId: $storeId\n    filter: {\n      itemCodeOrName: { like: $itemCodeOrName }\n      expiryDate: { beforeOrEqualTo: $expiryDate }\n      hasPacksInStore: true\n    }\n    sort: { key: itemName, desc: false }\n    page: { first: 5000 }\n  ) {\n    ... on StockLineConnector {\n      nodes {\n        batch\n        expiryDate\n        id\n        packSize\n        storeId\n        totalNumberOfPacks\n        supplierName\n        location {\n          code\n        }\n        item {\n          code\n          name\n          unitName\n          stats(storeId: $storeId) {\n            averageMonthlyConsumption\n          }\n        }\n      }\n    }\n  }\n}\n",
              "variables": null
            }
          },
          "template.html": {
            "type": "TeraTemplate",
            "data": {
              "output": "Html",
              "template": "<style>{% include \"style.css\" %}</style>\n\n<div class=\"container\">\n  <table>\n    <thead>\n      <tr class=\"heading\">\n        <td>Code</td>\n        <td>Name</td>\n        <td>Expiring in (days)</td>\n        <td>Batch</td>\n        <td>Expiry date</td>\n        <td>Stock on hand</td>\n        <td>Expected usage</td>\n        <td>Stock at risk</td>\n      </tr>\n    </thead>\n    <tbody>\n      {% for stockLine in data.stockLines.nodes %}\n      {% set now = now() | date(format=\"%s\") | int %}\n\n      <tr>\n        <td>{{stockLine.item.code}}</td>\n        <td>{{stockLine.item.name}}</td>\n        <td class=\"expiry-date\">\n          {% if stockLine.expiryDate %}\n            {% set expiryDate = stockLine.expiryDate | date(format=\"%s\") | int %}\n              {% if expiryDate > now %}\n                {% set diff = (expiryDate - now) / 60 / 60 / 24 | int %}\n                {% if diff <= arguments.monthsItemsExpire * 30 %}\n                  <span class=\"soon\">{{ diff }}</span>\n                {% else %}\n                  <span class=\"all-good\">{{ diff }}</span>\n                {% endif %}\n              {% else %}\n               <span class=\"expired\">Expired</span>\n              {% endif %}\n          {% else %}\n            <span class=\"na\">N/A</span>\n          {% endif %}\n        </td>\n        <td>{{stockLine.batch}}</td>\n        <td>\n          {% if stockLine.expiryDate %}\n            {{ stockLine.expiryDate | date(format=\"%d/%m/%Y\") }}\n          {% else %}\n            \n          {% endif %}\n        </td>\n        <td>{{stockLine.totalNumberOfPacks * stockLine.packSize | round( precision=1)\n          }}</td>\n        <td>\n          {% if stockLine.item.stats.averageMonthlyConsumption %}\n            {% if stockLine.expiryDate %}\n              {% set expiryDate = stockLine.expiryDate | date(format=\"%s\") | int %}\n              {% if expiryDate > now %}\n                {% set diffMonths = (expiryDate - now) / 60 / 60 / 24 / 30 | int | abs %}\n                {% set expectedUsage = stockLine.item.stats.averageMonthlyConsumption\n                  * diffMonths %}\n                {{ expectedUsage | round( precision=1) }}\n              {% else %}\n                N/A\n              {% endif %}\n            {% else %}\n              N/A\n            {% endif %}\n          {% else %}\n            N/A\n          {% endif %}\n        </td>\n        <td>\n          {% if stockLine.item.stats.averageMonthlyConsumption %}\n            {% if stockLine.expiryDate %}\n              {% set expiryDate = stockLine.expiryDate | date(format=\"%s\") | int %}\n              {% if expiryDate > now %}\n                {% set diffMonths = (expiryDate - now) / 60 / 60 / 24 / 30 | int | abs %}\n                {% set expectedUsage = stockLine.item.stats.averageMonthlyConsumption\n                  * diffMonths %}\n                {{ stockLine.totalNumberOfPacks * stockLine.packSize - expectedUsage | round( precision=1) }}\n              {% else %}\n                {{ stockLine.totalNumberOfPacks * stockLine.packSize | round( precision=1) }}\n              {% endif %}\n            {% else %}\n              N/A\n            {% endif %}\n          {% else %}\n            {% if stockLine.expiryDate %}\n              {% set expiryDate = stockLine.expiryDate | date(format=\"%s\") | int %}\n              {% if expiryDate < now %} \n                {{ stockLine.totalNumberOfPacks * stockLine.packSize | round( precision=1) }}\n              {% else %}\n                N/A\n              {% endif %}\n            {% else %}\n              N/A\n            {% endif %}\n          {% endif %}\n        </td>\n      </tr>\n      {% endfor %}\n    </tbody>\n  </table>\n</div>"
            }
          }
        }
      },
      "context": "REPORT",
      "sub_context": "Expiring",
      "argument_schema_id": "for_report_expiring-items_2.3.0",
      "comment": null,
      "is_custom": false,
      "version": "2.3.0",
      "code": "expiring-items",
      "form_schema": {
        "id": "for_report_expiring-items_2.3.0",
        "type": "reportArgument",
        "json_schema": {
          "$schema": "http://json-schema.org/draft-07/schema#",
          "allOf": [
            {
              "$ref": "#/definitions/StockFilters"
            }
          ],
          "definitions": {
            "StockFilters": {
              "properties": {
                "expiryDate": {
                  "description": "Expiry Date",
                  "format": "date",
                  "type": "string"
                },
                "itemCodeOrName": {
                  "description": "Item Code or Name",
                  "type": "string"
                },
                "monthlyConsumptionLookBackPeriod": {
                  "description": "Average Monthly Consumption Look Back Period",
                  "readOnly": true,
                  "type": "number"
                },
                "monthsItemsExpire": {
                  "description": "Expiring item period",
                  "readOnly": true,
                  "type": "number"
                },
                "monthsOverstock": {
                  "description": "Months Overstock",
                  "readOnly": true,
                  "type": "number"
                },
                "monthsUnderstock": {
                  "description": "Months Understock",
                  "readOnly": true,
                  "type": "number"
                }
              }
            }
          },
          "type": "object"
        },
        "ui_schema": {
          "elements": [
            {
              "label": "Expiry Date",
              "options": {
                "dateOnly": true
              },
              "scope": "#/properties/expiryDate",
              "type": "Control"
            },
            {
              "label": "Item Code or Name",
              "options": {
                "flexBasis": "90%",
                "useDebounce": false
              },
              "scope": "#/properties/itemCodeOrName",
              "type": "Control"
            },
            {
              "label": "AMC Lookback Period",
              "options": {
                "inputAlignment": "end",
                "paddingRight": 25
              },
              "scope": "#/properties/monthlyConsumptionLookBackPeriod",
              "type": "Control"
            },
            {
              "label": "Target MOS",
              "options": {
                "inputAlignment": "end",
                "paddingRight": 25
              },
              "scope": "#/properties/monthsOverstock",
              "type": "Control"
            },
            {
              "label": "Reorder threshold MOS",
              "options": {
                "inputAlignment": "end",
                "paddingRight": 25
              },
              "scope": "#/properties/monthsUnderstock",
              "type": "Control"
            },
            {
              "label": "Expiring item period",
              "options": {
                "inputAlignment": "end",
                "paddingRight": 25
              },
              "scope": "#/properties/monthsItemsExpire",
              "type": "Control"
            }
          ],
          "type": "VerticalLayout"
        }
      }
    }
  ]
}